(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[569],{6:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/blog/2024/react-relay-get-connections",function(){return t(9857)}])},5990:function(e){e.exports={externalIcon:"ExternalLink_externalIcon__gmpoW"}},9857:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return c}});var r=t(5893);t(7294);var o=t(9739),s=t(8143),i=t(5485),a=t(3293);function c(){return(0,r.jsxs)(o.Z,{title:"Get all connections for a key with react relay?",createdAt:"2024-06-01T10:18:33.097Z",tags:"technology",description:"React Relay uses a key for accessing a connection. In this article, we will explore a way to get all connections for a given key from the relay store, regardless of the different filters on them",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)(i.Z,{href:"https://relay.dev/",text:"React Relay",externalIcon:!0})," ","is a popular library to connect the GraphQL backend with React.js-based front-end applications. If you are already using it, you know how it provides two different ways to modify the relay store. One is using directives like ",(0,r.jsx)("code",{children:"@prependEdge"}),". Another method is to programmatically modify the relay store. When your application is in the early stages, you can just get everything done with the directives. But once it grows, you often have to manually modify the react store more often than you like to."]}),(0,r.jsx)("h4",{children:"Problem"}),(0,r.jsxs)("p",{children:["When you are modifying the store programmatically, there are many helpful helper methods available. One such key helper method is called"," ",(0,r.jsx)("code",{children:"ConnectionHandler.getConnection"}),". It gets you the connection you want to modify by passing a parent record and key. Suppose you have a simple connection for displaying members for a user, denoted by the key ",(0,r.jsx)("code",{children:"Members_user_members"}),". It is fairly simple to access this connection."]}),(0,r.jsx)(s.Z,{language:"javascript",children:"const user = store.get(userID);\nconst connection = ConnectionHandler.getConnection(user, 'Members_user_members');\n"}),(0,r.jsxs)("p",{children:["But what if you want to add pagination and search to this connection? That means three variables :- ",(0,r.jsx)("code",{children:"$first, $after, $query"})," for filters. ",(0,r.jsx)("code",{children:"getConnection"})," will only return connection that match exact filters passed to it. There is an article about"," ",(0,r.jsx)(i.Z,{href:"https://relay.dev/docs/next/guided-tour/list-data/updating-connections/#connection-identity-with-filters",text:"this",externalIcon:!0})," ","on the Relay website."]}),(0,r.jsx)("p",{children:"So if you want to remove an edge from this connection, you will have to :-"}),(0,r.jsxs)("ul",{children:[(0,r.jsx)("li",{children:"Keep track of all possible values for filters"}),(0,r.jsx)("li",{children:"Get a connection for each such combination"}),(0,r.jsx)("li",{children:"Remove the edge from that combination"})]}),(0,r.jsxs)("p",{children:["There is a relevant"," ",(0,r.jsx)(i.Z,{href:"https://github.com/facebook/relay/issues/1861",text:"issue",externalIcon:!0})," ","about this. This issue requests a new helper method called"," ",(0,r.jsx)("code",{children:"getConnections"}),"."]}),(0,r.jsx)("h4",{children:"Solution"}),(0,r.jsx)("p",{children:"Such a connection will store data roughly in this format."}),(0,r.jsx)(a.Z,{alt:"relay-store-data",src:"/media/2024/june/1.png",width:"1080",height:"300"}),(0,r.jsx)("p",{children:"Below is the implementation of the helper method, which will get all connections for a key. It generates a bare connection identity and extracts records based on that identity, regardless of different filter arguments."}),(0,r.jsx)(s.Z,{language:"javascript",children:"import { ConnectionHandler, RecordProxy } from 'relay-runtime';\nimport type { ReadOnlyRecordProxy } from 'relay-runtime/lib/store/RelayStoreTypes';\n\nfunction connectionExists(\n  connection: RecordProxy | null | undefined,\n): connection is RecordProxy {\n  return !!connection;\n}\n\nexport function getConnections(\n  record: ReadOnlyRecordProxy,\n  key: string,\n): Array<RecordProxy> {\n  const dataID = record.getDataID();\n  const bareConnectionId = ConnectionHandler.getConnectionID(dataID, key);\n\n  // @ts-ignore\n  const handleKeys = record._mutator._base.getRecordIDs().filter(\n    // ignore edges:0, pageInfo suffix\n    (id: string) => id.startsWith(bareConnectionId) && id.endsWith(')'),\n  );\n\n  return (\n    (handleKeys as string[])\n      // @ts-ignore\n      .map((handleKey) => record._source.get(handleKey))\n      .filter(connectionExists)\n  );\n}"}),(0,r.jsx)("p",{children:"After getting access to all the connections for a given key, you may modify them as per your application logic."})]})}},8143:function(e,n,t){"use strict";t.d(n,{Z:function(){return i}});var r=t(5893);t(7294);var o=t(4767),s=t(545);function i(e){let{language:n,children:t}=e;return(0,r.jsx)(o.Z,{language:n,style:s._4,children:t})}},5485:function(e,n,t){"use strict";var r=t(5893);t(7294);var o=t(3967),s=t(4066),i=t(5990);n.Z=function(e){let{children:n,className:t,href:a,text:c,externalIcon:l}=e;return(0,r.jsxs)("a",{className:o(t),href:a,target:"_blank",children:[n,c&&(0,r.jsx)("span",{className:"me-1",children:c}),l&&(0,r.jsx)(s.CkN,{className:i.externalIcon})]})}},3293:function(e,n,t){"use strict";t.d(n,{Z:function(){return a}});var r=t(5893),o=t(5675);let s=e=>{let{src:n}=e;return"".concat(n)},i=o.default;function a(e){return(0,r.jsx)("div",{className:"col col-md-8",children:(0,r.jsx)(i,{loader:s,src:e.src,width:e.width,height:e.height,alt:e.alt,sizes:"100vw",className:"w-100 h-auto",unoptimized:!0,quality:100})})}},9739:function(e,n,t){"use strict";t.d(n,{Z:function(){return y}});var r=t(5893),o=t(7294),s=t(2962),i=t(3944),a=t(1163),c=t(7564),l=t(1832),d=t(2891),h=t(8353);function u(e){let{date:n}=e;return(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{className:"badge bg-info me-2 p-2 text-uppercase",children:"Posted on "}),(0,r.jsx)("span",{className:"badge bg-dark me-2 p-2",children:new Date(n).toDateString()})]})}var f=t(4066);function y(e){let{children:n,title:t,description:y,createdAt:m}=e,{push:x,asPath:p}=(0,a.useRouter)(),g=o.useRef(null),j=o.useRef(null),b=e=>{e.current&&e.current.scrollIntoView({behavior:"smooth",block:"start"})};return t=d(t),(0,r.jsxs)(h.Z,{title:t,children:[(0,r.jsx)(s.dX,{url:"https://sushantdhiman.com".concat(p),type:"BlogPosting",title:t,description:y,datePublished:m,authorName:"Sushant Dhiman"}),(0,r.jsxs)("div",{ref:j,children:[(0,r.jsx)("span",{className:"float-start",children:(0,r.jsx)(u,{date:m})}),(0,r.jsx)("span",{className:"float-end",children:(0,r.jsxs)(c.Z,{children:[(0,r.jsx)(l.Z,{onClick:()=>x("/blog"),size:"sm",color:"primary",children:(0,r.jsx)(f.x_l,{})}),(0,r.jsx)(l.Z,{onClick:()=>b(g),size:"sm",color:"primary",children:(0,r.jsx)(f.NWQ,{})})]})}),(0,r.jsx)("span",{className:"clearfix"})]}),(0,r.jsx)("br",{}),n,(0,r.jsx)("br",{ref:g}),(0,r.jsx)(l.Z,{onClick:()=>b(j),color:"primary",size:"sm",children:(0,r.jsx)(f.ZTc,{})}),(0,r.jsx)("br",{}),(0,r.jsx)("br",{}),(0,r.jsx)(i.qw,{shortname:"sushantdhiman-github-io",config:{title:t}})]})}},8353:function(e,n,t){"use strict";t.d(n,{Z:function(){return a}});var r=t(5893);t(7294);var o=t(3967),s=t(9008),i=t(2891);function a(e){let{title:n,headTitle:t,children:a,className:c}=e;return(0,r.jsxs)("div",{className:o("my-3",c),children:[(0,r.jsx)(s,{children:(0,r.jsx)("title",{children:"".concat(i(t||n)," | Sushant Dhiman")})}),n&&(0,r.jsx)("h1",{className:"my-5 text-center text-primary",children:i(n)}),a]})}}},function(e){e.O(0,[900,545,675,888,774,179],function(){return e(e.s=6)}),_N_E=e.O()}]);