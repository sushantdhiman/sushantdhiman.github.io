(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[381],{9850:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/blog/2022/continuous-deployment-of-google-cloud-functions-written-with-typescript",function(){return t(2795)}])},2795:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return a}});var i=t(5893),o=(t(7294),t(4362)),r=t(3391),s=t(9191),c=t(6576);function a(){return(0,i.jsxs)(r.Z,{children:[(0,i.jsx)("h4",{children:"Introduction"}),(0,i.jsx)("p",{children:"Recently, I was trying to continuously deploy a Google Cloud Function, triggered with Cloud Pub/Sub. But the catch was that this function was written in TypeScript. Every article I could find was either using plain JavaScript or recommending cloning the Github repository with Google Cloud Source. There was also the choice of keeping compiled code in the repository."}),(0,i.jsx)("p",{children:"I was looking for a simple setup like Cloud Run, which linked to my Github repository and continuously built and deployed without any hassle. Let's see how you can accomplish this with Cloud Build."}),(0,i.jsx)("h4",{children:"Using Cloud Build"}),(0,i.jsxs)("p",{children:["First, you need to grant access to your Github repo to the"," ",(0,i.jsx)("strong",{children:"Google Cloud Build"})," Github app. This can be done in"," ",(0,i.jsx)(s.Z,{href:"https://github.com/settings/apps/authorizations",text:"Github app authorizations section",externalIcon:!0}),"."]}),(0,i.jsxs)("p",{children:["The next step will be to create a ",(0,i.jsx)("strong",{children:"Cloud Build Trigger"}),". You can find this option in"," ",(0,i.jsx)(s.Z,{href:"https://console.cloud.google.com/cloud-build/triggers",text:"Google cloud console",externalIcon:!0}),"."]}),(0,i.jsxs)("p",{children:["Configure the cloud build to your liking. Set the"," ",(0,i.jsx)("strong",{children:"Source"})," to your Github repository."]}),(0,i.jsx)(c.Z,{src:"/media/2022/june/1.png",width:"699px",height:"254px"}),(0,i.jsxs)("p",{children:["Next, we need to define what to do when the repository is updated. This can be defined in different ways, but I have selected the"," ",(0,i.jsx)("strong",{children:"Inline cloud build configuration YAML"})," option."]}),(0,i.jsx)(c.Z,{src:"/media/2022/june/2.png",width:"583px",height:"485px"}),(0,i.jsxs)("p",{children:["Now click on ",(0,i.jsx)("strong",{children:"Open Editor"})," to change the configuration YAML file. I am giving the code below directly, then I will explain what is happening."]}),(0,i.jsx)(o.Z,{language:"yaml",children:"steps:\n  - name: 'node:16-slim'\n    args:\n      - '-c'\n      - |\n        npm ci &&\n        npm run build &&\n        mkdir -p /workspace/dist &&\n        cp package.json /workspace/dist/package.json &&\n        cp -r lib /workspace/dist\n    entrypoint: bash\n  - name: gcr.io/cloud-builders/gcloud-slim\n    args:\n      - functions\n      - deploy\n      - <function_name>\n      - '--region'\n      - asia-south2\n      - '--trigger-topic'\n      - <pub_sub_topic_name>\n      - '--timeout'\n      - 10s\n      - '--memory'\n      - 128mb\n      - '--runtime'\n      - nodejs16\n      - '--entry-point'\n      - <entrypoint_name>\n      - '--max-instances'\n      - '2'\n      - '--source'\n      - /workspace/dist\n"}),(0,i.jsxs)("p",{children:["In the first step, we are using the Node 16 image to install node dependencies, then building the repository using"," ",(0,i.jsx)("code",{children:"npm run build"}),". The main point to note here is that we are copying built artifacts to the ",(0,i.jsx)("code",{children:"/workspace/dist"})," directory."]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("code",{children:"/workspace"})," is a special path in Cloud Build, where different steps can keep files to share with other steps."]}),(0,i.jsxs)("p",{children:["In the second step, we are using gcloud to deploy our function from the"," ",(0,i.jsx)("code",{children:"/workspace/dist"})," directory, with the ",(0,i.jsx)("code",{children:"--source"})," ","flag. Other options can be configured to meet the needs of your function."]}),(0,i.jsx)("p",{children:"Finally, save this build trigger. Now you will have a continuously deployed cloud function written in TypeScript."})]})}},4362:function(e,n,t){"use strict";t.d(n,{Z:function(){return s}});var i=t(5893),o=(t(7294),t(8954)),r=t(6671);function s(e){var n=e.language,t=e.children;return(0,i.jsx)(o.Z,{language:n,style:r._4,children:t})}},6576:function(e,n,t){"use strict";t.d(n,{Z:function(){return c}});var i=t(5893),o=t(5675),r=t.n(o),s=function(e){var n=e.src;return"".concat(n)};function c(e){return(0,i.jsx)(r(),{loader:s,src:e.src,width:e.width,height:e.height,unoptimized:!0,quality:100})}},3391:function(e,n,t){"use strict";t.d(n,{Z:function(){return f}});var i=t(5893),o=t(7294),r=t(3944),s=t(1163),c=t.n(s),a=t(674);function l(e){var n=e.date;return(0,i.jsxs)("span",{children:[(0,i.jsx)("span",{className:"badge bg-info me-2 p-2 text-uppercase",children:"Posted on "}),(0,i.jsx)("span",{className:"text-success",children:new Date(n).toDateString()})]})}var d=t(1966),u=t(5940),h=t.n(u),p=[{name:"Avrodh: Privacy Focused Site Blocker",imageSrc:"/avrodh_icon.png",link:"https://avrodh.com?utm_source=sdblog&utm_medium=banner"}];function g(){return(0,i.jsxs)(d.X2,{children:[(0,i.jsx)(d.X2,{children:(0,i.jsx)(d.JX,{className:"text-center text-white fw-bold fs-5 bg-primary",children:"Sponsors"})}),(0,i.jsx)(d.X2,{className:"my-2",children:p.map((function(e){return(0,i.jsx)(d.JX,{md:12,lg:6,className:"mb-lg-0 mb-3",children:(0,i.jsx)("a",{href:e.link,target:"_blank",className:"pointer",children:(0,i.jsx)(d.Zb,{children:(0,i.jsxs)(d.X2,{className:"g-0",children:[(0,i.jsx)(d.JX,{xs:4,className:"text-center",children:(0,i.jsx)(d.Mo,{className:h().product_logo,src:e.imageSrc,alt:"Product logo"})}),(0,i.jsx)(d.JX,{xs:8,className:"align-items-center d-flex",children:(0,i.jsx)(d.eW,{children:(0,i.jsx)("h5",{children:e.name})})})]})})})},e.name)}))}),(0,i.jsx)(d.X2,{children:(0,i.jsx)(d.JX,{className:"text-center text-white py-1 bg-primary",children:"Get in touch to show your product here"})})]})}var m=t(7814),x=t(8994);function f(e){var n=e.children,t=o.useRef(null),u=o.useRef(null),h=function(e){e.current&&e.current.scrollIntoView({behavior:"smooth",block:"start"})},p=(0,s.useRouter)(),f=x.find((function(e){return e.href===p.pathname}));return(0,i.jsxs)(a.Z,{title:f.name,children:[(0,i.jsxs)("div",{ref:u,children:[(0,i.jsx)("span",{className:"float-start",children:(0,i.jsx)(l,{date:f.createdAt})}),(0,i.jsx)("span",{className:"float-end",children:(0,i.jsxs)(d.hE,{children:[(0,i.jsx)(d.zx,{onClick:function(){return c().push("/blog")},size:"sm",variant:"primary",children:(0,i.jsx)(m.G,{icon:"arrow-left"})}),(0,i.jsx)(d.zx,{onClick:function(){return h(t)},size:"sm",variant:"primary",children:(0,i.jsx)(m.G,{icon:"arrow-down"})})]})}),(0,i.jsx)("span",{className:"clearfix"})]}),(0,i.jsx)("br",{}),n,(0,i.jsx)("br",{ref:t}),(0,i.jsx)(d.zx,{onClick:function(){return h(u)},variant:"primary",size:"sm",children:(0,i.jsx)(m.G,{icon:"arrow-up"})}),(0,i.jsx)("br",{}),(0,i.jsx)("br",{}),(0,i.jsx)(g,{}),(0,i.jsx)(r.qw,{shortname:"sushantdhiman-github-io",config:{title:f.name}})]})}},674:function(e,n,t){"use strict";t.d(n,{Z:function(){return d}});var i=t(5893),o=(t(7294),t(4184)),r=t.n(o),s=t(9008),c=t.n(s),a=t(2891),l=t.n(a);function d(e){var n=e.title,t=e.children,o=e.className;return(0,i.jsxs)("div",{className:r()("my-3",o),children:[(0,i.jsx)(c(),{children:(0,i.jsxs)("title",{children:["Sushant Dhiman | ",l()(n)]})}),(0,i.jsx)("h2",{className:"my-3 text-center text-primary",children:l()(n)}),t]})}},5940:function(e){e.exports={product_logo:"Adverts_product_logo__Iw6ik"}},8994:function(e){"use strict";e.exports=JSON.parse('[{"href":"/blog/2022/blind-city-of-the-blind-king","name":"Blind city of the blind king","createdAt":"2022-08-13T11:19:13.000Z","updatedAt":"2022-08-13T11:09:13.401Z"},{"href":"/blog/2022/continuous-deployment-of-google-cloud-functions-written-with-typescript","name":"Continuous deployment of google cloud functions written with typescript","createdAt":"2022-06-08T03:31:18.000Z","updatedAt":"2022-06-08T03:28:29.407Z"},{"href":"/blog/2021/odoo-dual-currency-invoice","name":"Odoo dual currency invoice","createdAt":"2021-12-30T13:22:04.000Z","updatedAt":"2021-12-30T13:20:15.278Z"},{"href":"/blog/2021/how-to-backup-imap-emails","name":"How to backup imap emails","createdAt":"2021-02-26T13:44:28.000Z","updatedAt":"2021-03-11T09:43:55.938Z"},{"href":"/blog/2020/vscode-to-neovim","name":"Vscode to neovim","createdAt":"2020-05-09T17:46:54.000Z","updatedAt":"2020-08-22T08:01:10.739Z"},{"href":"/blog/price","name":"Price","createdAt":"2018-06-24T10:30:00.000Z","updatedAt":"2020-08-22T08:01:10.739Z"},{"href":"/blog/diminishing-capability","name":"Diminishing capability","createdAt":"2018-02-11T08:30:00.000Z","updatedAt":"2020-08-22T08:01:10.739Z"},{"href":"/blog/parabel-of-onion","name":"Parabel of onion","createdAt":"2016-05-16T07:30:00.000Z","updatedAt":"2020-08-22T08:01:10.739Z"}]')}},function(e){e.O(0,[735,671,675,774,888,179],(function(){return n=9850,e(e.s=n);var n}));var n=e.O();_N_E=n}]);