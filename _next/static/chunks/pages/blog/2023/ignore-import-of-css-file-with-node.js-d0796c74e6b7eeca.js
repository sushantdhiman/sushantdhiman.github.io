(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[16],{7466:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/blog/2023/ignore-import-of-css-file-with-node.js",function(){return t(9320)}])},9320:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return a}});var s=t(5893);t(7294);var r=t(7037),i=t(1304),o=t(4187);function a(){return(0,s.jsxs)(r.Z,{title:"Ignore import of css file with node.js",createdAt:"2023-05-27T13:03:53.000Z",tags:"technology",children:[(0,s.jsxs)("p",{children:["Recently, I had to migrate a couple of web services to the Node.js 20 runtime. With Node.js 20, you get support for stable"," ",(0,s.jsx)(o.Z,{href:"https://nodejs.org/api/test.html",text:"test runner",externalIcon:!0}),". My codebase is mostly TypeScript. From my experience, ESM, TypeScript, and Mocha will always give you headaches. So I decided to migrate mocha tests to the native test runner. For the most part, everything went smoothly."]}),(0,s.jsxs)("p",{children:["There was an issue, as my React code was importing some styles and images. In old code, I used"," ",(0,s.jsx)("code",{children:"require.extensions['css'] = noop"})," to ignore require of styles in tests. So I was looking for something similar with the ESM setup. I discovered there is a stable flag called ",(0,s.jsx)("code",{children:"--loader"}),", which can be used to modify how imports are handled by Node.js."]}),(0,s.jsx)("p",{children:"After some tinkering, I ended up with the following code: This code ignores styles and images when running a script using Node.js."}),(0,s.jsx)(i.Z,{language:"javascript",children:"import { URL } from 'url';\n\nfunction test(input) {\n  return (\n    input.endsWith('.css') || input.endsWith('.svg') || input.endsWith('.png')\n  );\n}\n\nexport function resolve(specifier, context, nextResolve) {\n  const { parentURL = null } = context;\n\n  if (test(specifier)) {\n    return {\n      shortCircuit: true,\n      url: new URL(specifier, parentURL).href,\n    };\n  } else if (parentURL && test(parentURL)) {\n    return {\n      shortCircuit: true,\n      url: new URL(specifier, parentURL).href,\n    };\n  }\n\n  // Let Node.js handle all other specifiers.\n  return nextResolve(specifier);\n}\n\nexport function load(url, context, nextLoad) {\n  if (test(url)) {\n    return {\n      format: 'module',\n      shortCircuit: true,\n      source: 'export default {}',\n    };\n  }\n\n  // Let Node.js handle all other URLs.\n  return nextLoad(url);\n}"})]})}},1304:function(e,n,t){"use strict";t.d(n,{Z:function(){return o}});var s=t(5893);t(7294);var r=t(4329),i=t(753);function o(e){let{language:n,children:t}=e;return(0,s.jsx)(r.Z,{language:n,style:i._4,children:t})}},7037:function(e,n,t){"use strict";t.d(n,{Z:function(){return p}});var s=t(5893),r=t(7294),i=t(3944),o=t(1163),a=t(3197),c=t(4217),l=t(2891),u=t(794);function d(e){let{date:n}=e;return(0,s.jsxs)("span",{children:[(0,s.jsx)("span",{className:"badge bg-info me-2 p-2 text-uppercase",children:"Posted on "}),(0,s.jsx)("span",{className:"badge bg-secondary me-2 p-2",children:new Date(n).toDateString()})]})}var h=t(5154);function p(e){let{children:n,title:t,tags:p,createdAt:f}=e,x=r.useRef(null),m=r.useRef(null),j=e=>{e.current&&e.current.scrollIntoView({behavior:"smooth",block:"start"})};return t=l(t),(0,s.jsxs)(u.Z,{title:t,children:[(0,s.jsxs)("div",{ref:m,children:[(0,s.jsx)("span",{className:"float-start",children:(0,s.jsx)(d,{date:f})}),(0,s.jsx)("span",{className:"float-end",children:(0,s.jsxs)(a.Z,{children:[(0,s.jsx)(c.Z,{onClick:()=>o.push("/blog"),size:"sm",variant:"primary",children:(0,s.jsx)(h.x_l,{})}),(0,s.jsx)(c.Z,{onClick:()=>j(x),size:"sm",variant:"primary",children:(0,s.jsx)(h.NWQ,{})})]})}),(0,s.jsx)("span",{className:"clearfix"})]}),(0,s.jsx)("br",{}),n,(0,s.jsx)("br",{ref:x}),(0,s.jsx)(c.Z,{onClick:()=>j(m),variant:"primary",size:"sm",children:(0,s.jsx)(h.ZTc,{})}),(0,s.jsx)("br",{}),(0,s.jsx)("br",{}),(0,s.jsx)(i.qw,{shortname:"sushantdhiman-github-io",config:{title:t}})]})}},794:function(e,n,t){"use strict";t.d(n,{Z:function(){return a}});var s=t(5893);t(7294);var r=t(4184),i=t(9008),o=t(2891);function a(e){let{title:n,children:t,className:a}=e;return(0,s.jsxs)("div",{className:r("my-3",a),children:[(0,s.jsx)(i,{children:(0,s.jsx)("title",{children:"Sushant Dhiman | ".concat(o(n))})}),(0,s.jsx)("h2",{className:"my-3 text-center text-primary",children:o(n)}),t]})}}},function(e){e.O(0,[530,753,774,888,179],function(){return e(e.s=7466)}),_N_E=e.O()}]);