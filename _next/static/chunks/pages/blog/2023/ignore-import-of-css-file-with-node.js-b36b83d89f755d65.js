(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[263],{2758:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var s=n(7876);n(4232);var r=n(9841),i=n(9084);function o(e){let{language:t,children:n}=e;return(0,s.jsx)(r.A,{language:t,style:i.KQ,showLineNumbers:!0,children:n})}},2900:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var s=n(7876);n(4232);var r=n(2870),i=n(5483),o=n.n(i);let a=function(e){let{children:t,className:n,href:i,text:a,externalIcon:l}=e;return(0,s.jsxs)("a",{className:n,href:i,target:"_blank",children:[t,a&&(0,s.jsx)("span",{className:"me-1",children:a}),l&&(0,s.jsx)(r.EQc,{className:o().externalIcon})]})}},4262:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/blog/2023/ignore-import-of-css-file-with-node.js",function(){return n(4633)}])},4633:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var s=n(7876);n(4232);var r=n(6243),i=n(2758),o=n(2900);function a(){return(0,s.jsxs)(r.A,{title:"Ignore import of css file with node.js",createdAt:"2023-05-27T13:03:53.000Z",tags:"technology",description:"Guide to properly testing React-based projects with the Node.js test runner and ignoring CSS and image imports with those tests",children:[(0,s.jsxs)("p",{children:["Recently, I had to migrate a couple of web services to the Node.js 20 runtime. With Node.js 20, you get support for stable"," ",(0,s.jsx)(o.A,{href:"https://nodejs.org/api/test.html",text:"test runner",externalIcon:!0}),". My codebase is mostly TypeScript. From my experience, ESM, TypeScript, and Mocha will always give you headaches. So I decided to migrate mocha tests to the native test runner. For the most part, everything went smoothly."]}),(0,s.jsxs)("p",{children:["There was an issue, as my React code was importing some styles and images. In old code, I used"," ",(0,s.jsx)("code",{children:"require.extensions['css'] = noop"})," to ignore require of styles in tests. So I was looking for something similar with the ESM setup. I discovered there is a stable flag called ",(0,s.jsx)("code",{children:"--loader"}),", which can be used to modify how imports are handled by Node.js."]}),(0,s.jsx)("p",{children:"After some tinkering, I ended up with the following code: This code ignores styles and images when running a script using Node.js."}),(0,s.jsx)(i.A,{language:"javascript",children:"import { URL } from 'url';\n\nfunction test(input) {\n  return (\n    input.endsWith('.css') || input.endsWith('.svg') || input.endsWith('.png')\n  );\n}\n\nexport function resolve(specifier, context, nextResolve) {\n  const { parentURL = null } = context;\n\n  if (test(specifier)) {\n    return {\n      shortCircuit: true,\n      url: new URL(specifier, parentURL).href,\n    };\n  } else if (parentURL && test(parentURL)) {\n    return {\n      shortCircuit: true,\n      url: new URL(specifier, parentURL).href,\n    };\n  }\n\n  // Let Node.js handle all other specifiers.\n  return nextResolve(specifier);\n}\n\nexport function load(url, context, nextLoad) {\n  if (test(url)) {\n    return {\n      format: 'module',\n      shortCircuit: true,\n      source: 'export default {}',\n    };\n  }\n\n  // Let Node.js handle all other URLs.\n  return nextLoad(url);\n}"})]})}},5483:e=>{e.exports={externalIcon:"ExternalLink_externalIcon__gmpoW"}},6243:(e,t,n)=>{"use strict";n.d(t,{A:()=>x});var s=n(7876),r=n(4232),i=n(2867),o=n(3606),a=n(9099),l=n(6676),c=n(6750),d=n(9079),h=n(8280);function u(e){let{date:t}=e;return(0,s.jsxs)("span",{children:[(0,s.jsx)("span",{className:"badge bg-info me-2 p-2 text-uppercase",children:"Posted on "}),(0,s.jsx)("span",{className:"badge bg-dark me-2 p-2",children:new Date(t).toDateString()})]})}var p=n(2870);function x(e){let{children:t,title:n,description:x,createdAt:m}=e,{push:j,asPath:f}=(0,a.useRouter)(),g=r.useRef(null),w=r.useRef(null),y=e=>{e.current&&e.current.scrollIntoView({behavior:"smooth",block:"start"})};return n=(0,d.A)(n),(0,s.jsxs)(h.A,{title:n,children:[(0,s.jsx)(i.dp,{images:[],url:"https://sushantdhiman.com".concat(f),type:"BlogPosting",title:n,description:x,datePublished:m,authorName:"Sushant Dhiman"}),(0,s.jsxs)("div",{ref:w,children:[(0,s.jsx)("span",{className:"float-start",children:(0,s.jsx)(u,{date:m})}),(0,s.jsx)("span",{className:"float-end",children:(0,s.jsxs)(l.A,{children:[(0,s.jsx)(c.A,{onClick:()=>j("/blog"),size:"sm",color:"primary",children:(0,s.jsx)(p.QVr,{})}),(0,s.jsx)(c.A,{onClick:()=>y(g),size:"sm",color:"primary",children:(0,s.jsx)(p.$TP,{})})]})}),(0,s.jsx)("span",{className:"clearfix"})]}),(0,s.jsx)("br",{}),t,(0,s.jsx)("br",{ref:g}),(0,s.jsx)(c.A,{onClick:()=>y(w),color:"primary",size:"sm",children:(0,s.jsx)(p.uCC,{})}),(0,s.jsx)("br",{}),(0,s.jsx)("br",{}),(0,s.jsx)(o.Mq,{shortname:"sushantdhiman-github-io",config:{title:n}})]})}},8280:(e,t,n)=>{"use strict";n.d(t,{A:()=>c});var s=n(7876);n(4232);var r=n(7328),i=n.n(r),o=n(9079),a=n(6587),l=n(7237);function c(e){let{title:t,headTitle:n,children:r}=e;return(0,s.jsxs)(a.A,{className:"justify-content-center",children:[(0,s.jsx)(i(),{children:(0,s.jsx)("title",{children:"".concat((0,o.A)(n||t)," | Sushant Dhiman")})}),(0,s.jsxs)(l.A,{md:"8",lg:"10",children:[t&&(0,s.jsx)("h1",{className:"my-5 text-center text-primary",children:(0,o.A)(t)}),r]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[97,84,636,593,792],()=>t(4262)),_N_E=e.O()}]);