(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[16],{7466:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/blog/2023/ignore-import-of-css-file-with-node.js",function(){return n(9320)}])},9320:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return a}});var r=n(5893);n(7294);var s=n(7037),o=n(1304),i=n(4187);function a(){return(0,r.jsxs)(s.Z,{children:[(0,r.jsxs)("p",{children:["Recently, I had to migrate a couple of web services to the Node.js 20 runtime. With Node.js 20, you get support for stable"," ",(0,r.jsx)(i.Z,{href:"https://nodejs.org/api/test.html",text:"test runner",externalIcon:!0}),". My codebase is mostly TypeScript. From my experience, ESM, TypeScript, and Mocha will always give you headaches. So I decided to migrate mocha tests to the native test runner. For the most part, everything went smoothly."]}),(0,r.jsxs)("p",{children:["There was an issue, as my React code was importing some styles and images. In old code, I used"," ",(0,r.jsx)("code",{children:"require.extensions['css'] = noop"})," to ignore require of styles in tests. So I was looking for something similar with the ESM setup. I discovered there is a stable flag called ",(0,r.jsx)("code",{children:"--loader"}),", which can be used to modify how imports are handled by Node.js."]}),(0,r.jsx)("p",{children:"After some tinkering, I ended up with the following code: This code ignores styles and images when running a script using Node.js."}),(0,r.jsx)(o.Z,{language:"javascript",children:"import { URL } from 'url';\n\nfunction test(input) {\n  return (\n    input.endsWith('.css') || input.endsWith('.svg') || input.endsWith('.png')\n  );\n}\n\nexport function resolve(specifier, context, nextResolve) {\n  const { parentURL = null } = context;\n\n  if (test(specifier)) {\n    return {\n      shortCircuit: true,\n      url: new URL(specifier, parentURL).href,\n    };\n  } else if (parentURL && test(parentURL)) {\n    return {\n      shortCircuit: true,\n      url: new URL(specifier, parentURL).href,\n    };\n  }\n\n  // Let Node.js handle all other specifiers.\n  return nextResolve(specifier);\n}\n\nexport function load(url, context, nextLoad) {\n  if (test(url)) {\n    return {\n      format: 'module',\n      shortCircuit: true,\n      source: 'export default {}',\n    };\n  }\n\n  // Let Node.js handle all other URLs.\n  return nextLoad(url);\n}"})]})}},1304:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(5893);n(7294);var s=n(4329),o=n(753);function i(e){let{language:t,children:n}=e;return(0,r.jsx)(s.Z,{language:t,style:o._4,children:n})}},7037:function(e,t,n){"use strict";n.d(t,{Z:function(){return p}});var r=n(5893),s=n(7294),o=n(3944),i=n(1163),a=n(3197),c=n(4217),l=n(794);function d(e){let{date:t}=e;return(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{className:"badge bg-info me-2 p-2 text-uppercase",children:"Posted on "}),(0,r.jsx)("span",{className:"badge bg-secondary me-2 p-2",children:new Date(t).toDateString()})]})}var u=n(5154),h=n(8994);function p(e){let{children:t}=e,n=s.useRef(null),p=s.useRef(null),f=e=>{e.current&&e.current.scrollIntoView({behavior:"smooth",block:"start"})},m=(0,i.useRouter)(),g=h.find(e=>e.href===m.pathname);return(0,r.jsxs)(l.Z,{title:g.name,children:[(0,r.jsxs)("div",{ref:p,children:[(0,r.jsx)("span",{className:"float-start",children:(0,r.jsx)(d,{date:g.createdAt})}),(0,r.jsx)("span",{className:"float-end",children:(0,r.jsxs)(a.Z,{children:[(0,r.jsx)(c.Z,{onClick:()=>i.push("/blog"),size:"sm",variant:"primary",children:(0,r.jsx)(u.x_l,{})}),(0,r.jsx)(c.Z,{onClick:()=>f(n),size:"sm",variant:"primary",children:(0,r.jsx)(u.NWQ,{})})]})}),(0,r.jsx)("span",{className:"clearfix"})]}),(0,r.jsx)("br",{}),t,(0,r.jsx)("br",{ref:n}),(0,r.jsx)(c.Z,{onClick:()=>f(p),variant:"primary",size:"sm",children:(0,r.jsx)(u.ZTc,{})}),(0,r.jsx)("br",{}),(0,r.jsx)("br",{}),(0,r.jsx)(o.qw,{shortname:"sushantdhiman-github-io",config:{title:g.name}})]})}},794:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(5893);n(7294);var s=n(4184),o=n(9008),i=n(2891);function a(e){let{title:t,children:n,className:a}=e;return(0,r.jsxs)("div",{className:s("my-3",a),children:[(0,r.jsx)(o,{children:(0,r.jsx)("title",{children:"Sushant Dhiman | ".concat(i(t))})}),(0,r.jsx)("h2",{className:"my-3 text-center text-primary",children:i(t)}),n]})}},8994:function(e){"use strict";e.exports=JSON.parse('[{"href":"/blog/2023/ignore-import-of-css-file-with-node.js","name":"Ignore import of css file with node.js","createdAt":"2023-05-27T13:03:53.000Z","updatedAt":"2023-05-27T13:02:07.668Z","tags":["technology"]},{"href":"/blog/2023/cloud-run-vs-cloud-functions","name":"Cloud run vs cloud functions","createdAt":"2023-04-11T11:35:24.000Z","updatedAt":"2023-05-27T12:47:22.490Z","tags":["technology"]},{"href":"/blog/2023/how-to-remove-all-text-box-from-pdf","name":"How to remove all text box from pdf","createdAt":"2023-04-09T12:46:12.000Z","updatedAt":"2023-04-09T12:44:52.681Z","tags":["technology"]},{"href":"/blog/2022/blind-city-of-the-blind-king","name":"Blind city of the blind king","createdAt":"2022-08-13T11:19:13.000Z","updatedAt":"2022-08-13T11:09:13.401Z","tags":["story"]},{"href":"/blog/2022/continuous-deployment-of-google-cloud-functions-written-with-typescript","name":"Continuous deployment of google cloud functions written with typescript","createdAt":"2022-06-08T03:31:18.000Z","updatedAt":"2023-04-09T12:06:53.955Z","tags":["technology"]},{"href":"/blog/2021/odoo-dual-currency-invoice","name":"Odoo dual currency invoice","createdAt":"2021-12-30T13:22:04.000Z","updatedAt":"2021-12-30T13:20:15.278Z","tags":["technology"]},{"href":"/blog/2021/how-to-backup-imap-emails","name":"How to backup imap emails","createdAt":"2021-02-26T13:44:28.000Z","updatedAt":"2021-03-11T09:43:55.938Z","tags":["technology"]},{"href":"/blog/2020/vscode-to-neovim","name":"Vscode to neovim","createdAt":"2020-05-09T17:46:54.000Z","updatedAt":"2020-08-22T08:01:10.739Z","tags":["technology"]},{"href":"/blog/price","name":"Price","createdAt":"2018-06-24T10:30:00.000Z","updatedAt":"2020-08-22T08:01:10.739Z","tags":["story"]},{"href":"/blog/diminishing-capability","name":"Diminishing capability","createdAt":"2018-02-11T08:30:00.000Z","updatedAt":"2020-08-22T08:01:10.739Z","tags":["thoughts"]},{"href":"/blog/parabel-of-onion","name":"Parabel of onion","createdAt":"2016-05-16T07:30:00.000Z","updatedAt":"2020-08-22T08:01:10.739Z","tags":["story"]}]')}},function(e){e.O(0,[530,753,774,888,179],function(){return e(e.s=7466)}),_N_E=e.O()}]);