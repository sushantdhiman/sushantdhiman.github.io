<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Get All Connections for a Key with React Relay? | Sushant Dhiman</title><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","datePublished":"2024-06-01T10:18:33.097Z","description":"React Relay uses a key for accessing a connection. In this article, we will explore a way to get all connections for a given key from the relay store, regardless of the different filters on them","mainEntityOfPage":{"@type":"WebPage","@id":"https://sushantdhiman.com/blog/2024/react-relay-get-connections"},"headline":"Get All Connections for a Key with React Relay?","dateModified":"2024-06-01T10:18:33.097Z","author":{"@type":"Person","name":"Sushant Dhiman"}}</script><meta name="next-head-count" content="4"/><link rel="icon" href="/favicon.ico"/><script async="" crossorigin="anonymous" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5521774148060332"></script><link rel="preload" href="/_next/static/css/c46b6ad54fadf770.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/c46b6ad54fadf770.css" crossorigin="" data-n-g=""/><link rel="preload" href="/_next/static/css/2fd0e922c71f7cc7.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/2fd0e922c71f7cc7.css" crossorigin="" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-8fa1640cc84ba8fe.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/framework-5429a50ba5373c56.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/main-f32c185034fc95de.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/_app-62f819f251228cfd.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/900-6167192cd7f95a7e.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/545-5285baf2eed8e80f.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/675-60eb980720466b5b.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/blog/2024/react-relay-get-connections-b6497df6973a40ad.js" defer="" crossorigin=""></script><script src="/_next/static/_l8jd4StTnt_5uOG4NRjm/_buildManifest.js" defer="" crossorigin=""></script><script src="/_next/static/_l8jd4StTnt_5uOG4NRjm/_ssgManifest.js" defer="" crossorigin=""></script></head><body><div id="__next"><div><nav class="container-fluid navbar navbar-expand-md navbar-light bg-light"><div class="container-md"><span class="Navigation_brand__jtqpT navbar-brand"><span>Sushant Dhiman</span></span><button aria-label="Toggle navigation" type="button" class="navbar-toggler"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse"><ul class="Navigation_navbar__sojs0 ms-auto navbar-nav"><li class="nav-item"><a class="nav-link" href="/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"></path></svg></a></li><li class="nav-item"><a class="nav-link active" href="/blog"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M172.2 226.8c-14.6-2.9-28.2 8.9-28.2 23.8V301c0 10.2 7.1 18.4 16.7 22 18.2 6.8 31.3 24.4 31.3 45 0 26.5-21.5 48-48 48s-48-21.5-48-48V120c0-13.3-10.7-24-24-24H24c-13.3 0-24 10.7-24 24v248c0 89.5 82.1 160.2 175 140.7 54.4-11.4 98.3-55.4 109.7-109.7 17.4-82.9-37-157.2-112.5-172.2zM209 0c-9.2-.5-17 6.8-17 16v31.6c0 8.5 6.6 15.5 15 15.9 129.4 7 233.4 112 240.9 241.5.5 8.4 7.5 15 15.9 15h32.1c9.2 0 16.5-7.8 16-17C503.4 139.8 372.2 8.6 209 0zm.3 96c-9.3-.7-17.3 6.7-17.3 16.1v32.1c0 8.4 6.5 15.3 14.8 15.9 76.8 6.3 138 68.2 144.9 145.2.8 8.3 7.6 14.7 15.9 14.7h32.2c9.3 0 16.8-8 16.1-17.3-8.4-110.1-96.5-198.2-206.6-206.7z"></path></svg> Blog</a></li><li class="nav-item"><a class="nav-link" href="/about"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 640 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M623.2 192c-51.8 3.5-125.7 54.7-163.1 71.5-29.1 13.1-54.2 24.4-76.1 24.4-22.6 0-26-16.2-21.3-51.9 1.1-8 11.7-79.2-42.7-76.1-25.1 1.5-64.3 24.8-169.5 126L192 182.2c30.4-75.9-53.2-151.5-129.7-102.8L7.4 116.3C0 121-2.2 130.9 2.5 138.4l17.2 27c4.7 7.5 14.6 9.7 22.1 4.9l58-38.9c18.4-11.7 40.7 7.2 32.7 27.1L34.3 404.1C27.5 421 37 448 64 448c8.3 0 16.5-3.2 22.6-9.4 42.2-42.2 154.7-150.7 211.2-195.8-2.2 28.5-2.1 58.9 20.6 83.8 15.3 16.8 37.3 25.3 65.5 25.3 35.6 0 68-14.6 102.3-30 33-14.8 99-62.6 138.4-65.8 8.5-.7 15.2-7.3 15.2-15.8v-32.1c.2-9.1-7.5-16.8-16.6-16.2z"></path></svg> About</a></li></ul></div></div></nav><div class="container-md"><div class="my-3"><h1 class="my-5 text-center text-primary">Get All Connections for a Key with React Relay?</h1><div><span class="float-start"><span><span class="badge bg-info me-2 p-2 text-uppercase">Posted on </span><span class="badge bg-dark me-2 p-2">Sat Jun 01 2024</span></span></span><span class="float-end"><div role="group" class="btn-group"><button type="button" class="btn btn-primary btn-sm"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"></path></svg></button><button type="button" class="btn btn-primary btn-sm"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M413.1 222.5l22.2 22.2c9.4 9.4 9.4 24.6 0 33.9L241 473c-9.4 9.4-24.6 9.4-33.9 0L12.7 278.6c-9.4-9.4-9.4-24.6 0-33.9l22.2-22.2c9.5-9.5 25-9.3 34.3.4L184 343.4V56c0-13.3 10.7-24 24-24h32c13.3 0 24 10.7 24 24v287.4l114.8-120.5c9.3-9.8 24.8-10 34.3-.4z"></path></svg></button></div></span><span class="clearfix"></span></div><br/><p><a class="" href="https://relay.dev/" target="_blank"><span class="me-1">React Relay</span><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="ExternalLink_externalIcon__gmpoW" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M432,320H400a16,16,0,0,0-16,16V448H64V128H208a16,16,0,0,0,16-16V80a16,16,0,0,0-16-16H48A48,48,0,0,0,0,112V464a48,48,0,0,0,48,48H400a48,48,0,0,0,48-48V336A16,16,0,0,0,432,320ZM488,0h-128c-21.37,0-32.05,25.91-17,41l35.73,35.73L135,320.37a24,24,0,0,0,0,34L157.67,377a24,24,0,0,0,34,0L435.28,133.32,471,169c15,15,41,4.5,41-17V24A24,24,0,0,0,488,0Z"></path></svg></a> <!-- -->is a popular library to connect the GraphQL backend with React.js-based front-end applications. If you are already using it, you know how it provides two different ways to modify the relay store. One is using directives like <code>@prependEdge</code>. Another method is to programmatically modify the relay store. When your application is in the early stages, you can just get everything done with the directives. But once it grows, you often have to manually modify the react store more often than you like to.</p><h4>Problem</h4><p>When you are modifying the store programmatically, there are many helpful helper methods available. One such key helper method is called<!-- --> <code>ConnectionHandler.getConnection</code>. It gets you the connection you want to modify by passing a parent record and key. Suppose you have a simple connection for displaying members for a user, denoted by the key <code>Members_user_members</code>. It is fairly simple to access this connection.</p><pre style="display:block;overflow-x:auto;padding:0.5em;background:#444;color:#ddd"><code class="language-javascript" style="white-space:pre"><span style="color:white;font-weight:bold">const</span><span> user = store.get(userID);
</span><span></span><span style="color:white;font-weight:bold">const</span><span> connection = ConnectionHandler.getConnection(user, </span><span style="color:#d88">&#x27;Members_user_members&#x27;</span><span>);
</span></code></pre><p>But what if you want to add pagination and search to this connection? That means three variables :- <code>$first, $after, $query</code> for filters. <code>getConnection</code> will only return connection that match exact filters passed to it. There is an article about<!-- --> <a class="" href="https://relay.dev/docs/next/guided-tour/list-data/updating-connections/#connection-identity-with-filters" target="_blank"><span class="me-1">this</span><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="ExternalLink_externalIcon__gmpoW" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M432,320H400a16,16,0,0,0-16,16V448H64V128H208a16,16,0,0,0,16-16V80a16,16,0,0,0-16-16H48A48,48,0,0,0,0,112V464a48,48,0,0,0,48,48H400a48,48,0,0,0,48-48V336A16,16,0,0,0,432,320ZM488,0h-128c-21.37,0-32.05,25.91-17,41l35.73,35.73L135,320.37a24,24,0,0,0,0,34L157.67,377a24,24,0,0,0,34,0L435.28,133.32,471,169c15,15,41,4.5,41-17V24A24,24,0,0,0,488,0Z"></path></svg></a> <!-- -->on the Relay website.</p><p>So if you want to remove an edge from this connection, you will have to :-</p><ul><li>Keep track of all possible values for filters</li><li>Get a connection for each such combination</li><li>Remove the edge from that combination</li></ul><p>There is a relevant<!-- --> <a class="" href="https://github.com/facebook/relay/issues/1861" target="_blank"><span class="me-1">issue</span><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="ExternalLink_externalIcon__gmpoW" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M432,320H400a16,16,0,0,0-16,16V448H64V128H208a16,16,0,0,0,16-16V80a16,16,0,0,0-16-16H48A48,48,0,0,0,0,112V464a48,48,0,0,0,48,48H400a48,48,0,0,0,48-48V336A16,16,0,0,0,432,320ZM488,0h-128c-21.37,0-32.05,25.91-17,41l35.73,35.73L135,320.37a24,24,0,0,0,0,34L157.67,377a24,24,0,0,0,34,0L435.28,133.32,471,169c15,15,41,4.5,41-17V24A24,24,0,0,0,488,0Z"></path></svg></a> <!-- -->about this. This issue requests a new helper method called<!-- --> <code>getConnections</code>.</p><h4>Solution</h4><p>Such a connection will store data roughly in this format.</p><div class="col col-md-8"><img alt="relay-store-data" loading="lazy" width="1080" height="300" decoding="async" data-nimg="1" class="w-100 h-auto" style="color:transparent" src="/media/2024/june/1.png"/></div><p>Below is the implementation of the helper method, which will get all connections for a key. It generates a bare connection identity and extracts records based on that identity, regardless of different filter arguments.</p><pre style="display:block;overflow-x:auto;padding:0.5em;background:#444;color:#ddd"><code class="language-javascript" style="white-space:pre"><span style="color:white;font-weight:bold">import</span><span> { ConnectionHandler, RecordProxy } </span><span style="color:white;font-weight:bold">from</span><span> </span><span style="color:#d88">&#x27;relay-runtime&#x27;</span><span>;
</span><span></span><span style="color:white;font-weight:bold">import</span><span> type { ReadOnlyRecordProxy } </span><span style="color:white;font-weight:bold">from</span><span> </span><span style="color:#d88">&#x27;relay-runtime/lib/store/RelayStoreTypes&#x27;</span><span>;
</span>
<span></span><span class="hljs-function" style="color:white;font-weight:bold">function</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#d88;font-weight:bold">connectionExists</span><span class="hljs-function">(</span><span class="hljs-function hljs-params">
</span><span class="hljs-function hljs-params">  connection: RecordProxy | </span><span class="hljs-function hljs-params" style="color:white;font-weight:bold">null</span><span class="hljs-function hljs-params"> | </span><span class="hljs-function hljs-params" style="color:white;font-weight:bold">undefined</span><span class="hljs-function hljs-params">,
</span><span class="hljs-function hljs-params"></span><span class="hljs-function">): </span><span class="hljs-function" style="color:#d88;font-weight:bold">connection</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#d88;font-weight:bold">is</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#d88;font-weight:bold">RecordProxy</span><span class="hljs-function"> </span><span>{
</span><span>  </span><span style="color:white;font-weight:bold">return</span><span> !!connection;
</span>}
<!-- -->
<span></span><span style="color:white;font-weight:bold">export</span><span> </span><span class="hljs-function" style="color:white;font-weight:bold">function</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#d88;font-weight:bold">getConnections</span><span class="hljs-function">(</span><span class="hljs-function hljs-params">
</span><span class="hljs-function hljs-params">  record: ReadOnlyRecordProxy,
</span><span class="hljs-function hljs-params">  key: string,
</span><span class="hljs-function hljs-params"></span><span class="hljs-function">): </span><span class="hljs-function" style="color:#d88;font-weight:bold">Array</span><span class="hljs-function">&lt;</span><span class="hljs-function" style="color:#d88;font-weight:bold">RecordProxy</span><span class="hljs-function">&gt; </span><span>{
</span><span>  </span><span style="color:white;font-weight:bold">const</span><span> dataID = record.getDataID();
</span><span>  </span><span style="color:white;font-weight:bold">const</span><span> bareConnectionId = ConnectionHandler.getConnectionID(dataID, key);
</span>
<span>  </span><span style="color:#777">// @ts-ignore</span><span>
</span><span>  </span><span style="color:white;font-weight:bold">const</span><span> handleKeys = record._mutator._base.getRecordIDs().filter(
</span><span>    </span><span style="color:#777">// ignore edges:0, pageInfo suffix</span><span>
</span><span>    </span><span class="hljs-function">(</span><span class="hljs-function hljs-params">id: string</span><span class="hljs-function">) =&gt;</span><span> id.startsWith(bareConnectionId) &amp;&amp; id.endsWith(</span><span style="color:#d88">&#x27;)&#x27;</span><span>),
</span>  );
<!-- -->
<span>  </span><span style="color:white;font-weight:bold">return</span><span> (
</span><span>    (handleKeys </span><span style="color:white;font-weight:bold">as</span><span> string[])
</span><span>      </span><span style="color:#777">// @ts-ignore</span><span>
</span><span>      .map(</span><span class="hljs-function">(</span><span class="hljs-function hljs-params">handleKey</span><span class="hljs-function">) =&gt;</span><span> record._source.get(handleKey))
</span>      .filter(connectionExists)
<!-- -->  );
<!-- -->}</code></pre><p>After getting access to all the connections for a given key, you may modify them as per your application logic.</p><br/><button type="button" class="btn btn-primary btn-sm"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"></path></svg></button><br/><br/><div id="disqus_thread"></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{}},"page":"/blog/2024/react-relay-get-connections","query":{},"buildId":"_l8jd4StTnt_5uOG4NRjm","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>