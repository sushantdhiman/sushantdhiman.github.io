<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Sushantdhiman.com - How to Backup Imap Emails</title><meta name="next-head-count" content="3"/><link rel="icon" href="/favicon.ico"/><link rel="preload" href="/_next/static/css/4e071674e5a3c08b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/4e071674e5a3c08b.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-34c76af51fb9f015.js" defer=""></script><script src="/_next/static/chunks/framework-381f319d8cf4e783.js" defer=""></script><script src="/_next/static/chunks/main-376210261aa63abf.js" defer=""></script><script src="/_next/static/chunks/pages/_app-2445892a20df7b61.js" defer=""></script><script src="/_next/static/chunks/735-f6530d15d744e2ce.js" defer=""></script><script src="/_next/static/chunks/671-cc77faae835d0f85.js" defer=""></script><script src="/_next/static/chunks/pages/blog/2021/how-to-backup-imap-emails-21af71e8047322e6.js" defer=""></script><script src="/_next/static/8jStFod1vQtgbF7w4Z9KO/_buildManifest.js" defer=""></script><script src="/_next/static/8jStFod1vQtgbF7w4Z9KO/_ssgManifest.js" defer=""></script><script src="/_next/static/8jStFod1vQtgbF7w4Z9KO/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div><nav class="container-fluid navbar navbar-expand-md navbar-dark bg-primary"><div class="container-md"><span class="Navigation_brand__5433m navbar-brand"><span>Sushantdhiman.com</span></span><button aria-label="Toggle navigation" type="button" class="navbar-toggler"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse"><ul class="Navigation_navbar__0TE08 me-auto navbar-nav"><li class="nav-item"><a href="/" class="nav-link">Home</a></li><li class="nav-item"><a href="/blog" class="active nav-link">Blog</a></li><li class="nav-item"><a href="/projects" class="nav-link">Projects</a></li><li class="nav-item"><a href="/about" class="nav-link">About</a></li></ul><ul class="Navigation_navbar__0TE08 ms-auto flex-row navbar-nav"><li class="nav-item"><a class="px-2 nav-link" href="mailto:sushantdhiman@outlook.com" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="envelope" class="svg-inline--fa fa-envelope me-1 ExternalLink_icon__6OvgU" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M464 64C490.5 64 512 85.49 512 112C512 127.1 504.9 141.3 492.8 150.4L275.2 313.6C263.8 322.1 248.2 322.1 236.8 313.6L19.2 150.4C7.113 141.3 0 127.1 0 112C0 85.49 21.49 64 48 64H464zM217.6 339.2C240.4 356.3 271.6 356.3 294.4 339.2L512 176V384C512 419.3 483.3 448 448 448H64C28.65 448 0 419.3 0 384V176L217.6 339.2z"></path></svg></a></li><li class="nav-item"><a class="px-2 nav-link" href="https://linkedin.com/in/sushantdhiman" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin me-1 ExternalLink_icon__6OvgU" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a></li><li class="nav-item"><a class="px-2 nav-link" href="https://gitlab.com/sushantdhiman" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="gitlab" class="svg-inline--fa fa-gitlab me-1 ExternalLink_icon__6OvgU" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M510.5 284.5l-27.26-83.96c.012 .038 .016 .077 .028 .115-.013-.044-.021-.088-.033-.132v-.01L429.1 33.87a21.33 21.33 0 0 0 -20.44-14.6A21.04 21.04 0 0 0 388.5 34L337.1 192.2H175L123.5 33.99A21.03 21.03 0 0 0 103.3 19.27h-.113A21.47 21.47 0 0 0 82.86 34L28.89 200.5l-.008 .021v0c-.013 .042-.019 .084-.033 .127 .012-.038 .017-.077 .029-.115L1.514 284.5a30.6 30.6 0 0 0 11.12 34.28L248.9 490.4c.035 .026 .074 .041 .109 .067 .1 .072 .2 .146 .3 .214-.1-.065-.187-.136-.282-.2l0 0c.015 .012 .033 .02 .05 .031s.027 .015 .041 .024l.006 0a11.99 11.99 0 0 0 1.137 .7c.054 .03 .1 .068 .157 .1l0 0c.033 .016 .064 .038 .1 .054s.053 .02 .077 .032 .038 .015 .056 .023c.044 .021 .092 .034 .136 .057 .205 .1 .421 .178 .633 .264 .2 .082 .389 .177 .592 .248l.025 .011c.034 .012 .064 .028 .1 .04s.083 .032 .125 .046l.05 .012c.053 .016 .11 .024 .163 .039 .019 .006 .042 .009 .063 .015 .284 .086 .579 .148 .872 .213 .115 .026 .225 .062 .341 .083 .017 0 .032 .009 .05 .012 .038 .008 .073 .021 .112 .027 .062 .011 .122 .031 .186 .04 .049 .007 .1 0 .151 .012h.033a11.92 11.92 0 0 0 1.7 .136h.019a11.97 11.97 0 0 0 1.7-.136h.033c.05-.008 .1 0 .153-.012s.124-.029 .187-.04c.038-.006 .073-.019 .11-.027 .017 0 .032-.009 .049-.012 .118-.023 .231-.059 .349-.084 .288-.064 .578-.126 .861-.21 .019-.006 .039-.008 .059-.014 .055-.017 .113-.024 .169-.041 .016-.006 .035-.007 .051-.012 .044-.013 .086-.032 .129-.047s.063-.028 .1-.041l.026-.01c.214-.076 .417-.175 .627-.261s.394-.154 .584-.245c.047-.023 .1-.036 .142-.059 .018-.009 .04-.015 .058-.024s.053-.02 .078-.033 .068-.04 .1-.056l0 0c.056-.028 .106-.069 .161-.1a12.34 12.34 0 0 0 1.132-.695c.029-.02 .062-.035 .092-.056 .008-.006 .017-.009 .024-.015 .035-.026 .076-.043 .11-.068l236.3-171.7A30.6 30.6 0 0 0 510.5 284.5zM408.8 49.48l46.34 142.7H362.5zm-305.6 0 46.43 142.7H56.95zM26.82 299.3a6.526 6.526 0 0 1 -2.361-7.308l20.34-62.42L193.8 420.6zm38.24-82.97h92.41L223.4 419.2zm183.4 273.8c-.047-.038-.092-.079-.138-.118-.009-.008-.018-.018-.028-.026-.091-.075-.18-.152-.268-.231-.172-.15-.341-.3-.5-.462 .014 .012 .029 .022 .043 .035l.055 .046a12.19 12.19 0 0 0 1.091 .929l.012 .011c.018 .013 .033 .03 .051 .045C248.7 490.3 248.6 490.2 248.5 490.1zm7.514-48.48L217.2 322.2 182.8 216.3H329.3zm7.935 48.11c-.091 .079-.178 .157-.27 .233l-.032 .028c-.047 .038-.091 .079-.136 .117-.1 .08-.209 .152-.313 .229 .018-.013 .033-.032 .053-.044l.009-.009a11.69 11.69 0 0 0 1.086-.926c.014-.013 .03-.024 .044-.036s.038-.03 .054-.047C264.3 489.4 264.1 489.6 263.9 489.7zm90.7-273.5h92.4l-18.91 24.23-139.5 178.7zm130.6 82.97L318.2 420.6 467.3 229.5l20.26 62.39A6.528 6.528 0 0 1 485.2 299.2z"></path></svg></a></li><li class="nav-item"><a class="px-2 nav-link" href="https://github.com/sushantdhiman" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github me-1 ExternalLink_icon__6OvgU" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3 .3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5 .3-6.2 2.3zm44.2-1.7c-2.9 .7-4.9 2.6-4.6 4.9 .3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3 .7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3 .3 2.9 2.3 3.9 1.6 1 3.6 .7 4.3-.7 .7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3 .7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3 .7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a></li></ul></div></div></nav><div class="container-md"><div class="my-3"><h2 class="my-3 text-center text-primary">How to Backup Imap Emails</h2><div><span class="float-start"><span><span class="badge bg-info me-2 p-2 text-uppercase">Posted on </span><span class="text-success">Fri Feb 26 2021</span></span></span><span class="float-end"><div role="group" class="btn-group"><button type="button" variant="primary" class="btn btn-secondary btn-sm"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrow-left" class="svg-inline--fa fa-arrow-left " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M447.1 256C447.1 273.7 433.7 288 416 288H109.3l105.4 105.4c12.5 12.5 12.5 32.75 0 45.25C208.4 444.9 200.2 448 192 448s-16.38-3.125-22.62-9.375l-160-160c-12.5-12.5-12.5-32.75 0-45.25l160-160c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25L109.3 224H416C433.7 224 447.1 238.3 447.1 256z"></path></svg></button><button type="button" variant="primary" class="btn btn-secondary btn-sm"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrow-down" class="svg-inline--fa fa-arrow-down " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="currentColor" d="M374.6 310.6l-160 160C208.4 476.9 200.2 480 192 480s-16.38-3.125-22.62-9.375l-160-160c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 370.8V64c0-17.69 14.33-31.1 31.1-31.1S224 46.31 224 64v306.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0S387.1 298.1 374.6 310.6z"></path></svg></button></div></span><span class="clearfix"></span></div><br/><h4>Preface</h4><p>Recently I bought some space for email hosting. For personal emails I use Gmail &amp; Outlook, so I never thought about keeping backup of my emails. But with this provider I wanted to keep off-site backup of my new email accounts.</p><p>I researched many CLI based tools for this. I think<!-- --> <a class="" href="https://isync.sourceforge.io/mbsync.html" target="_blank"><span class="me-1">mbsync</span><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="up-right-from-square" class="svg-inline--fa fa-up-right-from-square ExternalLink_icon__6OvgU" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M384 320c-17.67 0-32 14.33-32 32v96H64V160h96c17.67 0 32-14.32 32-32s-14.33-32-32-32L64 96c-35.35 0-64 28.65-64 64V448c0 35.34 28.65 64 64 64h288c35.35 0 64-28.66 64-64v-96C416 334.3 401.7 320 384 320zM488 0H352c-12.94 0-24.62 7.797-29.56 19.75c-4.969 11.97-2.219 25.72 6.938 34.88L370.8 96L169.4 297.4c-12.5 12.5-12.5 32.75 0 45.25C175.6 348.9 183.8 352 192 352s16.38-3.125 22.62-9.375L416 141.3l41.38 41.38c9.156 9.141 22.88 11.84 34.88 6.938C504.2 184.6 512 172.9 512 160V24C512 10.74 501.3 0 488 0z"></path></svg></a> <!-- -->works best for this. It supports bidirectional and one-way sync, which is required for backup and restore.</p><p>Our goal here is to download emails in <code>Maildir</code> format and then backup them using <code>rclone</code>.</p><h4>Configuring mbsync</h4><p>By default <code>mbsync</code> uses <code>~/.mbsyncrc</code> file as default configuration, but it supports custom config with<!-- --> <code>-c</code> argument. We are going to use this option, so we can switch between different configuration files.</p><p>Here is a sample configuration file for pulling emails to a local directory</p><pre style="display:block;overflow-x:auto;padding:0.5em;background:#444;color:#ddd"><code class="language-bash" style="white-space:pre"><span style="color:#777"># .mbsyncrc_pull</span><span>
</span><span></span><span style="color:#777"># global options</span><span>
</span>Create Slave
<!-- -->Expunge Slave
<!-- -->Sync Pull
<span></span><span style="color:#777"># required when moving emails with email client</span><span>
</span>CopyArrivalDate yes
<!-- -->
<!-- -->IMAPAccount email-me
<!-- -->Host mail.email.com
<!-- -->User me@email.com
<span>PassCmd </span><span style="color:#d88">&quot;gpg -q --for-your-eyes-only --no-tty -d email.pass&quot;</span><span>
</span>SSLType IMAPS
<!-- -->CertificateFile /etc/ssl/certs/ca-certificates.crt
<!-- -->
<span></span><span style="color:#777"># mappings</span><span>
</span>IMAPStore remote-email-me
<!-- -->Account email-me
<!-- -->
<span></span><span style="color:#777"># local storage we&#x27;ll be using. Note the trailing slash at the end of the Path</span><span>
</span>MaildirStore local-email-me
<!-- -->Path ~/imap-backup/mails/email/me/
<!-- -->Inbox ~/imap-backup/mails/email/me/Inbox
<!-- -->SubFolders Verbatim
<!-- -->
<span></span><span style="color:#777"># channels</span><span>
</span>Channel sync-email-me
<!-- -->Master :remote-email-me:
<!-- -->Slave :local-email-me:
<!-- -->Patterns * !Junk !Trash
<!-- -->SyncState *</code></pre><h4>GPG for encrypting/decrypting passwords</h4><p>We don&#x27;t want to keep plaintext passwords in the configuration file. We can use GPG to encrypt/decrypt passwords in our local system.</p><p>You can use the following command to encrypt password :-</p><pre style="display:block;overflow-x:auto;padding:0.5em;background:#444;color:#ddd"><code class="language-bash" style="white-space:pre"><span style="color:#d88">echo</span><span> </span><span style="color:#d88">&quot;password&quot;</span><span> | gpg --symmetric --armor &gt; secret.pass</span></code></pre><p>It will ask for a passphrase.</p><p>Then you can use the following command to decrypt this file :-</p><pre style="display:block;overflow-x:auto;padding:0.5em;background:#444;color:#ddd"><code class="language-bash" style="white-space:pre"><span>gpg -q --for-your-eyes-only --no-tty -d secret.pass</span></code></pre><p>You will be prompted for passphrase which was entered when encrypting this file.</p><h4>Configuration details</h4><p>This configuration is specifically for pulling emails to local disk.<!-- --> <code>Sync Pull</code> indicates we want to pull emails from our<!-- --> <code>IMAPStore</code> to <code>MaildirStore</code>.</p><p><code>CopyArrivalDate</code> is here to ensure correct dates are used when moving emails with email clients.</p><p><code>IMAPAccount</code> defines remote IMAP account. Notice<!-- --> <code>PassCmd</code> is using GPG decryption that was explained in last section.</p><p><code>IMAPStore/Account</code> mapping links an email account with IMAP store. <code>MaildirStore</code> is used for defining local disk path where <code>Maildir</code> will be stored.</p><p>Lastly we have channels, <code>Channel</code> is used to define which direction emails will flow. Because of <code>Sync Pull</code> mails will go from <code>Master</code> to <code>Slave</code>.</p><p>Once you have configured your email account, emails can be downloaded using the following command :-</p><pre style="display:block;overflow-x:auto;padding:0.5em;background:#444;color:#ddd"><code class="language-bash" style="white-space:pre"><span>mbsync -aq -c .mbsyncrc_pull</span></code></pre><h4>Backup using rclone</h4><p><a class="" href="https://rclone.org/" target="_blank"><span class="me-1">mbsync</span><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="up-right-from-square" class="svg-inline--fa fa-up-right-from-square ExternalLink_icon__6OvgU" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M384 320c-17.67 0-32 14.33-32 32v96H64V160h96c17.67 0 32-14.32 32-32s-14.33-32-32-32L64 96c-35.35 0-64 28.65-64 64V448c0 35.34 28.65 64 64 64h288c35.35 0 64-28.66 64-64v-96C416 334.3 401.7 320 384 320zM488 0H352c-12.94 0-24.62 7.797-29.56 19.75c-4.969 11.97-2.219 25.72 6.938 34.88L370.8 96L169.4 297.4c-12.5 12.5-12.5 32.75 0 45.25C175.6 348.9 183.8 352 192 352s16.38-3.125 22.62-9.375L416 141.3l41.38 41.38c9.156 9.141 22.88 11.84 34.88 6.938C504.2 184.6 512 172.9 512 160V24C512 10.74 501.3 0 488 0z"></path></svg></a> <!-- -->is a good option for CLI based backups. We have downloaded emails in a directory, we just need to upload it as a zip file.</p><p>Configuring <code>rclone</code> to use your choice of backend is explained in details on their website.</p><p>In <code>Maildir</code> there are some additional files which we don&#x27;t need in zip archive. Use the following command for preparing zip :-</p><pre style="display:block;overflow-x:auto;padding:0.5em;background:#444;color:#ddd"><code class="language-bash" style="white-space:pre"><span>zip -q -r emails.zip mails -x </span><span style="color:#d88">&#x27;*/*.mbsyncstate&#x27;</span><span> </span><span style="color:#d88">&#x27;*/*.uidvalidity&#x27;</span></code></pre><p>Finally move zip file to remote location with the following command :-</p><pre style="display:block;overflow-x:auto;padding:0.5em;background:#444;color:#ddd"><code class="language-bash" style="white-space:pre"><span>rclone move emails.zip remote:&lt;remote_backup_path&gt;</span></code></pre><h4>Conclusion</h4><p>Here we have discussed how to take IMAP backup using <code>mbsync</code> <!-- -->and <code>rclone</code>. Similarly <code>mbsync</code> can be used for restoring emails back to IMAP server. Readers should be able to figure that out. If I get some time in future I will try to write a post about restoring emails.</p><br/><button type="button" variant="primary" class="btn btn-secondary btn-sm"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrow-up" class="svg-inline--fa fa-arrow-up " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="currentColor" d="M374.6 246.6C368.4 252.9 360.2 256 352 256s-16.38-3.125-22.62-9.375L224 141.3V448c0 17.69-14.33 31.1-31.1 31.1S160 465.7 160 448V141.3L54.63 246.6c-12.5 12.5-32.75 12.5-45.25 0s-12.5-32.75 0-45.25l160-160c12.5-12.5 32.75-12.5 45.25 0l160 160C387.1 213.9 387.1 234.1 374.6 246.6z"></path></svg></button><br/><br/><div id="disqus_thread"></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/blog/2021/how-to-backup-imap-emails","query":{},"buildId":"8jStFod1vQtgbF7w4Z9KO","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>